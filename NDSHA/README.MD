***In a nutshell :*** *I created this code to obtain engineering parameters from synthetic earthquake signals (i.e. time histories) produced by the MS technique as featured in the NDSHA methodology (Panza 2001, 2012). The code reads and processes a large dataset of earthquake signals, calculating the parameters using a set of functions and keeping track of the range of settings associated to the simulations. I included several plotting options to clearly visualize the data and results. The final output is a dataframe containing seismic parameters derived from simulations that can be compared to earthquake observation data in a companion project section.*

### Background

The section /portfolio/seismic_records provided a set of engineering eathquake parameters thanks to instrumental data associated to actual UK earthquakes and recorded at several seismic stations scattered across the UK. In this section, the work involved producing a dataset of synthetic earthquake signals (i.e. time histories) with the MS techniques for these UK earthquakes and recording stations connected to seismic observations. I hence generated time histories for stations operating on broadband (B-channel) and high broadband (H-channel), just as instrumental data were available on both these channels.
    
    
### Precisions about earthquake ground motion simulations and corresponding dataset

In generating the synthetic time histories, some specifics related to simulation settings had to be accounted for:
* the upper corner frequency : synthetic signals can and were generated only for a 10 Hz upper frequency, hence the frequency "Tree branch" only includes 10 Hz (and not 25 Hz or 35 Hz as in portfolio/seismic_records).
* the earthquake fault-rupture realisation : this can be seen as the beginning of an earthquake, when the accumulated stress is released from a nucleation point located randomly along the plane fault (Figure 1). From the nucleation point starts a wave - the rupture front - that triggers other weak points along the fault as it propagates away from the nucleation point.
* the directivity : the angle formed between the direction taken by the rupture front and the recording station location, for which three angle values - 0°, 90° and 180° - are of particular interest since they cover the range of possible subsequent amplitude values.


> Figure 1. Two examples of earthquake fault-rupturing, illustrating several seismicity terms (directivity, random location of nucleation point...).

<img src="https://user-images.githubusercontent.com/126000617/226198042-78561d11-1299-441d-9300-1b79b45e23f7.png" alt="realisation type" width="900"/>


&nbsp; &nbsp; &nbsp; &nbsp; The randomness in fault-rupture realisation and the directivity angle both create variations in earthquake signal amplitudes (see Figure 2) and need to be accounted for. This is achieved by simulating, for each earthquake and each associated seismic monitoring station, 100 earthquake realisations for each of the three directivity angles. Finally, for a given recording station, time histories are generated separately for each horizontal component (East-West EW, North-South NS) and for each ground motion type (acceleration, velocity, displacement).         
Upon simulation of signals covering all settings previously discussed, the folder and subfolders containing the time histories have the following organisation:
- bil000/
- bil090/
   - quake_dudley_Bchan/
   - quake_folkestone_Hchan/
     - real10/
     - real20/
     - real30/
       - signal/
         - ukr0006f2f2.sew.000001.plt
         - ukr0006f2f2.sns.000001.plt
         - ukr0009f2f2.sew.000002.plt
         - ukr0009f2f2.sns.000002.plt
         - ukr0006f1f1.sew.000001.plt
         - ukr0006f1f1.sns.000001.plt
         - ukr0009f1f1.sew.000002.plt
         - ukr0009f1f1.sns.000002.plt
         - ukr0006f0f0.sew.000001.plt
         - ukr0006f0f0.sns.000001.plt
         - ukr0009f0f0.sew.000002.plt
         - ukr0009f0f0.sns.000002.plt
   - quake_rasen_Bchan/
   - quake_rasen_Hchan/
   - quake_swansea_Bchan/
   - quake_swansea_Hchan/
- bil180/


The directivity angles, earthquake names and monitoring channels and fault-rupture realisation index appear in subfolder names (ex: bil000, dudley, Bchan, real20).     
The time history (*.plt) files contain no metadata, but file names (automatically generated by the algorithm), one example of which is shown below, contain the rest of useful information such as index of crustal structure (integer) on which the station is located, ground motion type (displacement, velocity or acceleration), horizontal component (sew or sns for EW or NS) and station index (integer), as well as the possible use of the setting "special mode DWN" ("pu") instead of "normal mode MS" (NA) when generating the accelerogram.          
As examples, the file names below :     

> &nbsp; &nbsp; &nbsp; &nbsp; i) &nbsp; ukr0001f2f2.sew.000001.plt"  
> &nbsp; &nbsp; &nbsp; &nbsp; ii) &nbsp; ukr0008puf1f1.sns.000010.plt" 

with i) structure #1, mode MS, acceleration type (f2), EW (sew), station #1,     
with ii) structure #8, mode DWN (pu), velocity type (f1), NS (sns), station #10.
     

### Using R code to process the earthquake time histories

A set of functions were defined at the beginning of the code in order to calculate seismic parameters such as spectral accelerations and parameters related to Arias intensity.      

#### Reading the dataset
&nbsp; &nbsp; The first part of the code (section I & II) aims at reading into R the large dataset of earthquake accelerograms produced by the MS technique algorithm.
I created a dataframe covering the different combinations of simulation settings and earthquake parameters, then created the file paths, finally tested the existence of all files to spot any possible missing *.plt files based on the anticipated number of dataframe rows.   
The set of *.plt files were then loaded into a list of dataframes and the file pairs EW & NS were joined to reduce the size of the list of dataframes.
NB : due to computer RAM limitations and subsequent difficulty in loading all displacement, velocity and acceleration files, the script shows only the building and reading acceleration files (f2f2); reading velocity or displacement is easily done by replacing f2f2 by f1f1 or f0f0 in the relevant lines of this first code section.
    
    
#### Reorganising the dataset
&nbsp; &nbsp; The second part of the code (section III) aims at re-organizing the files into a Tree structure, to reflect the folder organisation on the computer and to mirror the structure used for the observation dataset (portfolio/seismic_records).
The folder organisation and file names helped with loading and managing the time histories as well as tracking seismic characteristics (earthquakes, stations...) and simulation settings associated to the signals.
Simulation settings "realisation" and "directivity" were tracked by incorporating them into the Tree structure implemented in portfolio/seismic_records, via the tree branches "directivity" and "real" which record the directivity angle and the realisation index respectively.
Earthquake name and station recording channels B-channel & H-channel are tracked. Since only one corner frequency is relevant for the simulations, no Tree branch "frequency" was inserted.    


#### Processing the dataset
&nbsp; &nbsp; The third part of the code (section IV and V) focuses on the calculation of all requested seismic engineering parameters (ie.e Peak amplitudes, spectral accelerations, parameters related to Arias intensity...) and their storing into a dataframe which grows as the script loops through each branch of the Tree. The Tree branch names are also incorporated in the growing dataframe to keep track of which settings the engineering parameters relate to.


#### Plotting the results
&nbsp; &nbsp; The fourth and last part of the code (section VI & VII) first connects the dataframe with the seismic engineering parameters to station metadata (station underlying geology, geocoordinates...), brings name formatting improvements and then provides visualization options for the results. This notably includes :
+ the distribution of amplitudes (Peak Ground Acceleration) owing to the randomness in fault-rupture processes (Figure 2),
+ the mapping of the seismicity recording stations across the UK land (Figure 3), 
+ the differences in underlying geologies between the stations (Figure 4).
     
A customized plotting theme was specifically created for the plots and is provided at the end of the script.

An example dataset with earthquake signals corresponding to different events, recording channels and stations is provided at the following link:
https://drive.google.com/drive/folders/1jdH0llIJzKXL89UEYmAZGeMVjHX_uXgJ?usp=sharing



> Figure 2. PGA Amplitude distribution associated to the seismic wavefront directivity angle in case of the Swansea earthquake

<img src="https://user-images.githubusercontent.com/61290423/211396042-991788bc-cfcd-451a-ab35-22b58d07fc4e.png" alt="PGA amp distr" width="750"/>



> Figure 3. Map of earthquakes and associated monitoring stations

<img src="https://user-images.githubusercontent.com/61290423/211563354-b06ce175-33f4-4b98-9f8a-5b616f313949.png" alt="map quakes station" width="650"/>



> Figure 4. Geology distribution associated to the seismic monitoring stations

<img src="https://user-images.githubusercontent.com/61290423/211395831-d7d4aeed-bae8-4f52-8a7b-dfe53c04a143.png" alt="geo distr" width="600"/>


References: 
+ Panza, G.F., Romanelli, F. and Vaccari, F., 2001. Seismic wave propagation in laterally heterogeneous anelastic media: theory and applications to seismic zonation. In Advances in geophysics (Vol. 43, pp. 1-95). Elsevier.

+ Panza, G.F., La Mura, C., Peresan, A., Romanelli, F. and Vaccari, F., 2012. Seismic hazard scenarios as preventive tools for a disaster resilient society. In Advances in geophysics (Vol. 53, pp. 93-165). Elsevier.




